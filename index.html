<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8" />
<!-- ‚úÖ ‡πÉ‡∏´‡πâ‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÉ‡∏ä‡πâ viewport ‡∏õ‡∏Å‡∏ï‡∏¥ ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏£‡∏≤‡∏Ñ‡∏∏‡∏°‡∏™‡πÄ‡∏Å‡∏•‡πÄ‡∏≠‡∏á‡∏î‡πâ‡∏ß‡∏¢ transform -->
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
<title>‡πÄ‡∏Å‡∏°: ‡∏™‡∏ß‡∏ô‡∏´‡∏£‡∏£‡∏©‡∏≤ ‡∏°‡∏≤‡∏ï‡∏£‡∏≤‡∏Ñ‡∏±‡∏ß‡∏™‡∏∞‡∏Å‡∏î</title>
<style>
/* ====================== ‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡πÅ‡∏ö‡∏ö‡∏ù‡∏±‡∏á ====================== */
@font-face{
  font-family: 'MyGameFont';
  src: url('image/THSarabunNew.woff2') format('woff2'),
       url('image/THSarabunNew.woff') format('woff'),
       url('image/THSarabunNew.ttf') format('truetype');
  font-weight: 400; font-style: normal; font-display: swap;
}
@font-face{
  font-family: 'MyGameFont';
  src: url('image/THSarabunNewBold.woff2') format('woff2'),
       url('image/THSarabunNewBold.woff') format('woff'),
       url('image/THSarabunNewBold.ttf') format('truetype');
  font-weight: 700; font-style: normal; font-display: swap;
}
html, body, button, input, select, textarea, .pill, .btn, .btn-mini,
.levelBtn, #startTitle, #countdown, .label, #timer {
  font-family: 'MyGameFont', system-ui, -apple-system, 'Segoe UI', Arial, sans-serif;
}

/* ====== ‡∏Å‡∏£‡∏≠‡∏ö‡πÄ‡∏Å‡∏°‡πÄ‡∏ï‡πá‡∏°‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ (‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á) ====== */
html,body{ height:100%; margin:0; background:#000; overflow:hidden; color:#fff; }
#game{
  position:relative; width:100vw; height:100vh; overflow:hidden;
  background:url("image/background3.png") center/cover no-repeat fixed;
}

/* ====== ‡πÄ‡∏ß‡∏ó‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î‡∏î‡∏µ‡πÑ‡∏ã‡∏ô‡πå 1280√ó720 ‡πÅ‡∏•‡πâ‡∏ß‡∏™‡πÄ‡∏Å‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏Å‡πâ‡∏≠‡∏ô ====== */
#stage{
  position:absolute; left:50%; top:50%;
  width:1280px; height:720px;
  transform-origin: top left;                  /* ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç */
  /* transform ‡∏ñ‡∏π‡∏Å‡∏ï‡∏±‡πâ‡∏á‡∏à‡∏≤‡∏Å JS ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô translate(-50%,-50%) scale(S) */
}

/* ====== ‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡∏´‡∏°‡∏∏‡∏ô‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ñ‡∏∑‡∏≠‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á ====== */
#rotateHint{
  position:fixed; inset:0; display:none; align-items:center; justify-content:center;
  background:rgba(0,0,0,.9); z-index:30000; text-align:center; padding:20px;
}
#rotateHint .card{
  background:#111; border:1px solid rgba(255,255,255,.12);
  border-radius:16px; padding:18px 22px; box-shadow:0 20px 60px rgba(0,0,0,.6);
  font-weight:900; font-size:22px;
}
@media (orientation:portrait){
  #rotateHint{ display:flex; }
}

/* ====== Landing ====== */
#landing{
  position: fixed; inset: 0;
  display: flex; flex-direction: column; gap: 22px;
  align-items: center; justify-content: center;
  background: url("image/background3.png") center/cover no-repeat fixed !important;
  z-index: 20000; transition: opacity .3s ease;
}
#landing.hide{ opacity: 0; pointer-events: none; visibility: hidden; }
#landing .brand{ width: min(92vw, 1100px); }
#landing .brand img{ width:100%; height:auto; display:block; max-height:320px; object-fit:contain; filter:drop-shadow(0 10px 30px rgba(0,0,0,.6)); }
.level-menu{ display:flex; flex-direction:column; gap:14px; width:min(92vw, 640px); }
.levelBtn{
  width:100%; padding:10px 16px; font-size: clamp(20px, 4vw, 34px); font-weight:1000; letter-spacing:.2px;
  border:0; border-radius:14px; color:#fff; background:rgba(0,0,0,.55);
  box-shadow:0 10px 28px rgba(0,0,0,.35); cursor:pointer; text-align:center;
  border:1px solid rgba(255,255,255,.18); backdrop-filter: blur(6px);
}
.levelBtn:hover{ filter:brightness(1.08) }
.levelBtn:active{ transform: translateY(1px); }

/* ====== HUD (‡∏¢‡πâ‡∏≤‡∏¢‡∏°‡∏≤‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô #stage ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏™‡πÄ‡∏Å‡∏•‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏ó‡∏µ) ====== */
.hud{
  position:absolute; left:12px; right:12px; top:12px;
  display:flex; align-items:center; gap:12px; justify-content:space-between; pointer-events:none; z-index:10;
}
.hud .left,.hud .right{ display:flex; align-items:center; gap:12px }
.pill{ background:rgba(0,0,0,.45); backdrop-filter:blur(6px); padding:8px 12px; border-radius:999px; box-shadow:0 4px 18px rgba(0,0,0,.25) }
#timer{ font-weight:700; font-variant-numeric:tabular-nums; letter-spacing:.5px; font-size:20px }
.btn-mini{ pointer-events:auto; background:#1f2937; color:#fff; border:none; border-radius:12px; padding:8px 12px; font-weight:800; cursor:pointer; box-shadow:0 4px 18px rgba(0,0,0,.25) }
.btn-mini:hover{ filter:brightness(1.1) }
#scoreWrap{ pointer-events:auto; }
.gauge{ position:relative; width:380px; max-width:42vw; height:18px; background:rgba(255,255,255,.12); border:1px solid rgba(255,255,255,.18); border-radius:999px; overflow:hidden }
.gauge .fill{ position:absolute; left:0; top:0; bottom:0; width:0%; background:#10b981; transition: width .18s ease, background-color .18s ease }
.gauge .label{ position:absolute; inset:0; display:grid; place-items:center; font-size:12px; font-weight:900; color:#fff; text-shadow:0 1px 4px rgba(0,0,0,.6); pointer-events:none }
.gauge .fruit{ position:absolute; right:8px; top:50%; transform:translateY(-50%); font-size:16px; pointer-events:none }

/* ====== ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏° / ‡∏à‡∏ö‡πÄ‡∏Å‡∏° ====== */
#startScreen{
  position:fixed; inset:0; display:none; flex-direction:column; align-items:center; justify-content:center;
  background:rgba(0,0,0,.9); z-index:9999; text-align:center; padding:24px;
}
#startTitle{ font-size:clamp(26px,5vw,48px); font-weight:900; margin-bottom:10px }
#startBtn{ margin-top:12px; padding:10px 18px; border:0; border-radius:12px; font-weight:800; cursor:pointer; background:#1f2937; color:#fff }
#startBtn:hover{ filter:brightness(1.1) }
#countdown{ display:none; font-size:clamp(56px,12vw,120px); font-weight:1000; line-height:1; margin-top:8px }

#overlay{ position:fixed; inset:0; display:grid; place-items:center; background:rgba(0,0,0,.55); visibility:hidden; opacity:0; transition:.25s; z-index:9999 }
#overlay.show{ visibility:visible; opacity:1 }
.panel{ background:rgba(20,20,20,.9); border:1px solid rgba(255,255,255,.1); padding:22px 26px; border-radius:20px; min-width:320px; text-align:center; box-shadow:0 20px 60px rgba(0,0,0,.5) }
.panel h1{ margin:0 0 6px; font-size:28px }
.panel p{ margin:8px 0 18px; opacity:.85 }
.btn{ background:#1f2937; color:#fff; border:none; border-radius:12px; padding:10px 16px; font-weight:700; cursor:pointer }
.btn:hover{ filter:brightness(1.1) }
.wrong-box{ margin-top:14px; text-align:left }
.wrong-title{ font-weight:900; font-size:30px; margin-bottom:8px }
.wrong-list{ display:flex; flex-wrap:wrap; gap:8px; max-height:140px; font-size:28px; overflow:auto }
.chip{ background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.12); padding:6px 10px; border-radius:999px; font-weight:700 }
#overlay .btn{ padding:12px 24px; font-size:20px; font-weight:900; border-radius:18px; min-width:180px }
#restartBtn { background:#1f2937; color:#fff; }
#selectLevelBtn { background:#2563eb; color:#fff; }
#selectLevelBtn:hover { background:#1d4ed8; }
#nextLevelBtn { background:#10b981; color:#fff; }
#nextLevelBtn:hover { background:#059669; }

/* ====== ‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠ (‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏ß‡∏ó‡∏µ) ====== */
#camFull{ position:absolute; inset:0; z-index:0; display:none; overflow:hidden; background:#000; pointer-events:none }
#camFull video{ position:absolute; inset:0; width:100%; height:100%; object-fit:cover; transform:scaleX(-1); pointer-events:none }

/* ====== ‡πÄ‡∏Å‡∏° 3 ‡πÄ‡∏•‡∏ô + kid + ‡∏ß‡∏á‡∏Ñ‡∏≥ (‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô #stage ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏™‡πÄ‡∏Å‡∏•‡∏ï‡∏≤‡∏°) ====== */
#kid{
  position:absolute; bottom:22px; left:50%;
  width:200px; height:230px; transform:translateX(-50%);
  background:url("image/kid.png") center/contain no-repeat; z-index:5; pointer-events:none;
}
#acceptBox{
  position:absolute; left:50%; top:75%; transform:translateX(-50%);
  display:inline-block; background:#fff; border:2px solid #000; border-radius:14px; z-index:6;
  box-shadow:0 8px 24px rgba(0,0,0,.35); pointer-events:none;
}
#acceptBox .txt{ font-weight:900; letter-spacing:.3px; font-size:36px; white-space:nowrap; color:#000; padding:4px 14px; }

.word{
  position:absolute; top:-160px; left:0;
  width:150px; height:150px; border-radius:50%;
  background:rgba(0,0,0,.48); border:2px solid rgba(255,255,255,.28);
  box-shadow:0 10px 22px rgba(0,0,0,.6); user-select:none; cursor:default; will-change:transform;
  overflow:visible; z-index:2;
}
.word .inner{ position:relative; width:100%; height:100% }
.word .fruit{ position:absolute; left:50%; top:32%; transform:translate(-50%,-50%); font-size:66px; line-height:1; pointer-events:none }
.word .label{ position:absolute; left:50%; top:60%; transform:translateX(-50%); font-weight:900; text-align:center; text-shadow:0 2px 6px rgba(0,0,0,.8); font-size:36px; white-space:nowrap; overflow:visible; color:#fff }

/* ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏∞‡∏™‡∏°‡πÉ‡∏ï‡πâ‡∏£‡∏π‡∏õ kid (‡∏ß‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏∏‡∏°‡∏Ç‡∏ß‡∏≤‡∏ö‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏ß‡∏ó‡∏µ‡πÉ‡∏ô HUD ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß) */
.accum{ font-weight:900; color:#ffd700; text-shadow:0 1px 6px rgba(0,0,0,.35); font-size:22px; padding:6px 12px; background:rgba(0,0,0,.45); border-radius:12px }

/* ====== ‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏≠‡∏¢‡∏Ç‡∏ß‡∏≤‡∏•‡πà‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ (‡∏ô‡∏≠‡∏Å‡πÄ‡∏ß‡∏ó‡∏µ) ====== */
.fab{
  position:fixed; right:12px; bottom:12px; width:44px; height:44px; border-radius:999px;
  background:rgba(0,0,0,.45); border:1px solid rgba(255,255,255,.3); color:#fff; font-size:18px; line-height:1;
  display:grid; place-items:center; cursor:pointer; z-index:10000;
}
#fsBtn{ right:12px; bottom:62px; }
</style>
</head>
<body>

<!-- ‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏´‡∏°‡∏∏‡∏ô‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô -->
<div id="rotateHint"><div class="card">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏´‡∏°‡∏∏‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏° ü´∂</div></div>

<div id="game" aria-label="‡∏™‡∏ô‡∏≤‡∏°‡πÄ‡∏Å‡∏°">
  <!-- ‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏ß‡∏ó‡∏µ -->
  <div id="camFull" aria-hidden="true">
    <video id="camFullVid" autoplay playsinline muted></video>
  </div>

  <!-- ‡πÄ‡∏ß‡∏ó‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î‡∏î‡∏µ‡πÑ‡∏ã‡∏ô‡πå (‡∏ó‡∏∏‡∏Å‡∏≠‡∏á‡∏Ñ‡πå‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡πÄ‡∏Å‡∏°‡∏≠‡∏¢‡∏π‡πà‡∏Ç‡πâ‡∏≤‡∏á‡πÉ‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏™‡πÄ‡∏Å‡∏•‡∏ï‡∏≤‡∏°) -->
  <div id="stage" aria-hidden="false">
    <div id="kid">
      <div id="acceptBox" role="note" aria-label="‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥">
        <div class="txt" id="ruleLabel">‡πÅ‡∏°‡πà ‡∏Å‡∏Å</div>
      </div>
    </div>

    <!-- HUD -->
    <div class="hud">
      <div class="left">
        <div class="stack">
          <div class="pill" id="timer">02:00</div>
          <div style="display:flex; gap:8px;">
            <button id="pauseBtn" class="btn-mini">‚è∏ ‡∏´‡∏¢‡∏∏‡∏î</button>
            <button id="quickRestart" class="btn-mini">‡∏Å‡∏•‡∏±‡∏ö‡∏™‡∏π‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
          </div>
        </div>
      </div>
      <div class="right">
        <div id="scoreWrap" class="pill" style="padding:10px 12px;">
          <div class="gauge" aria-label="‡∏´‡∏•‡∏≠‡∏î‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô">
            <div class="fill" id="scoreFill"></div>
            <div class="label"><span id="scoreText">0</span>%</div>
            <div class="fruit" id="scoreFruit">üçé</div>
          </div>
        </div>
        <div class="stack" style="align-items:flex-end">
          <div id="accumWrap" class="accum">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏∞‡∏™‡∏°: <b id="accumVal">0</b></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Landing -->
  <div id="landing" role="dialog" aria-modal="true">
    <div class="brand"><img src="image/banner3.png" alt="Banner"></div>
    <div class="level-menu">
      <button class="levelBtn" data-level="0">‡∏°‡∏≤‡∏ï‡∏£‡∏≤‡∏ï‡∏±‡∏ß‡∏™‡∏∞‡∏Å‡∏î ‡πÅ‡∏°‡πà ‡∏Å‡∏Å</button>
      <button class="levelBtn" data-level="1">‡∏°‡∏≤‡∏ï‡∏£‡∏≤‡∏ï‡∏±‡∏ß‡∏™‡∏∞‡∏Å‡∏î ‡πÅ‡∏°‡πà ‡∏Å‡∏î</button>
      <button class="levelBtn" data-level="2">‡∏°‡∏≤‡∏ï‡∏£‡∏≤‡∏ï‡∏±‡∏ß‡∏™‡∏∞‡∏Å‡∏î ‡πÅ‡∏°‡πà ‡∏Å‡∏ô</button>
      <button class="levelBtn" data-level="3">‡∏°‡∏≤‡∏ï‡∏£‡∏≤‡∏ï‡∏±‡∏ß‡∏™‡∏∞‡∏Å‡∏î ‡πÅ‡∏°‡πà ‡∏Å‡∏ö</button>
      <button class="levelBtn" id="guideBtn">‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô üìã</button>
    </div>
  </div>

  <!-- ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏° -->
  <div id="startScreen">
    <div id="startTitle">‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à: ‡∏Ç‡∏¢‡∏±‡∏ö‡πÑ‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</div>
    <button id="startBtn">‡πÄ‡∏£‡∏¥‡πà‡∏°</button>
    <div id="countdown">3</div>
  </div>

  <!-- ‡∏´‡∏ô‡πâ‡∏≤‡∏ã‡πâ‡∏≠‡∏ô: ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠ -->
  <div id="guideScreen" style="display:none;">
    <div class="guide-wrap">
      <img src="image/guide.png" alt="‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡πÄ‡∏Å‡∏°">
      <button id="guideBack" class="btn-mini guide-close">‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å</button>
    </div>
  </div>

  <!-- ‡∏à‡∏ö‡πÄ‡∏Å‡∏° -->
  <div id="overlay">
    <div class="panel">
      <h1 id="endTitle">‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤!</h1>
      <p>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢: <b id="finalScore">0</b>%</p>
      <p id="accumSummary" style="display:none; color:#ffd700; font-weight:900;">
        ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏∞‡∏™‡∏°‡∏£‡∏ß‡∏° (4 ‡∏£‡∏≠‡∏ö): <b id="accumTotal">0</b>
      </p>
      <div class="wrong-box" style="display:none;">
        <div class="wrong-title">‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡∏°‡∏≤‡∏ú‡∏¥‡∏î</div>
        <div id="wrongList" class="wrong-list"></div>
      </div>
      <div class="actions">
        <button class="btn" id="restartBtn">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà</button>
        <button class="btn" id="selectLevelBtn">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏î‡πà‡∏≤‡∏ô</button>
        <button class="btn" id="nextLevelBtn">‡∏î‡πà‡∏≤‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</button>
      </div>
    </div>
  </div>

  <!-- ‡πÄ‡∏™‡∏µ‡∏¢‡∏á -->
  <audio id="hitSound" preload="auto"></audio>
  <audio id="winSound" preload="auto"></audio>
  <audio id="bgm" preload="auto"></audio>

  <!-- ‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏û‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡πÄ‡∏•‡πá‡∏Å (‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ) -->
  <div id="camWrap" aria-hidden="false" style="display:none;">
    <video id="camPreview" autoplay playsinline muted></video>
    <div id="camGrid" aria-hidden="true"></div>
  </div>
</div>

<!-- ‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏≠‡∏¢: Mute + ‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠ -->
<button id="muteBtn" class="fab" aria-pressed="false" title="Mute / Unmute">üîä</button>
<button id="fsBtn"   class="fab" title="‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠/‡∏•‡πá‡∏≠‡∏Å‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô">‚õ∂</button>

<script>
/* ====== ‡∏ï‡∏±‡∏ß‡∏ä‡πà‡∏ß‡∏¢: ‡∏Ñ‡∏∏‡∏°‡∏™‡πÄ‡∏Å‡∏•‡πÄ‡∏ß‡∏ó‡∏µ‡πÉ‡∏´‡πâ‡∏û‡∏≠‡∏î‡∏µ‡∏Å‡∏±‡∏ö‡∏à‡∏≠ (‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô) ====== */
(function(){
  const DESIGN_W = 1280, DESIGN_H = 720;
  const stage = document.getElementById('stage');
  function fitStage(){
    const vw = window.innerWidth, vh = window.innerHeight;
    const scale = Math.min(vw / DESIGN_W, vh / DESIGN_H);
    stage.style.transform = `translate(-50%,-50%) scale(${scale})`;
  }
  window.addEventListener('resize', fitStage, { passive:true });
  window.addEventListener('orientationchange', fitStage, { passive:true });
  document.addEventListener('DOMContentLoaded', fitStage);
  fitStage();
})();
</script>

<!-- ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° Mute -->
<script>
(function(){
  const muteBtn = document.getElementById('muteBtn');
  let isMuted = false;
  function applyMute(m){
    isMuted = !!m;
    document.querySelectorAll('audio').forEach(a => {
      a.muted = isMuted;
      if(isMuted){ a.setAttribute('muted',''); } else { a.removeAttribute('muted'); }
    });
    muteBtn.setAttribute('aria-pressed', String(isMuted));
    muteBtn.textContent = isMuted ? 'üîá' : 'üîä';
  }
  muteBtn.addEventListener('click', () => applyMute(!isMuted));
})();
</script>

<!-- ‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠ + ‡∏•‡πá‡∏≠‡∏Å‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô (‡∏ñ‡πâ‡∏≤‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö) -->
<script>
(function(){
  const fsBtn = document.getElementById('fsBtn');
  async function goFullscreen(){
    try{
      if(!document.fullscreenElement){ await document.documentElement.requestFullscreen(); }
      else{ await document.exitFullscreen(); }
    }catch(e){}
    try{
      if(screen.orientation && screen.orientation.lock){
        await screen.orientation.lock('landscape');
      }
    }catch(e){}
  }
  fsBtn.addEventListener('click', goFullscreen);
})();
</script>

<!-- ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏®‡∏µ‡∏£‡∏©‡∏∞‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô (‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏°) -->
<script>
(function(){
  const motionBtn = document.createElement('button');
  Object.assign(motionBtn, { id:'motionBtn', innerText:'üì∑: Off', title:'‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î ‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏®‡∏µ‡∏£‡∏©‡∏∞' });
  Object.assign(motionBtn.style, {
    position:'fixed', right:'112px', bottom:'12px', width:'44px', height:'44px',
    borderRadius:'999px', background:'rgba(0,0,0,.45)', border:'1px solid rgba(255,255,255,.3)',
    color:'#fff', fontSize:'18px', display:'grid', placeItems:'center', cursor:'pointer', zIndex:10000
  });
  document.body.appendChild(motionBtn);

  const video = document.createElement('video');
  video.autoplay = true; video.playsInline = true; video.muted = true; video.style.display='none';
  document.body.appendChild(video);

  const camWrap = document.getElementById('camWrap');
  const camPreview = document.getElementById('camPreview');
  const camFull   = document.getElementById('camFull');
  const camFullVid= document.getElementById('camFullVid');

  let overlay = document.getElementById('camOverlay');
  if (!overlay && camWrap){
    overlay = document.createElement('canvas');
    overlay.id = 'camOverlay';
    Object.assign(overlay.style, { position:'absolute', inset:'0', pointerEvents:'none' });
    camWrap.appendChild(overlay);
  }
  function clearOverlay(){ if(!overlay) return; const g=overlay.getContext('2d'); g.clearRect(0,0,overlay.width,overlay.height); }

  let stream=null, enabled=false, rafId=0, heartbeatId=0, watchdogId=0;
  const MIRROR = true;

  const ROI_Y_MIN = 0.20, ROI_Y_MAX = 0.85;
  const LUMA_MIN  = 30;
  const SMOOTH_ALPHA = 0.35;
  const PERSIST_FR = 3;
  const LEFT_ENTER=0.40, RIGHT_ENTER=0.60;
  const LEFT_COMMIT=0.35, RIGHT_COMMIT=0.65;
  const MIN_BLOB_AREA = 0.003;
  const SPEED_THRESH  = 0.004;

  let currentLane=1, pendingLane=null, persistCount=0, smoothX=0.5;
  let targetLane=1, lastLockTs=0;

  function sendLane(l){
    if (window.__GAME__?.__isRunning?.()){
      window.__GAME__.moveLane?.(l);
    }
  }
  function commitLane(cxNorm){
    let target=currentLane;
    if (cxNorm < LEFT_ENTER) target=0;
    else if (cxNorm > RIGHT_ENTER) target=2;
    else if (cxNorm > 0.45 && cxNorm < 0.55) target=1;

    if (target!==currentLane){
      if (pendingLane!==target){ pendingLane=target; persistCount=1; }
      else persistCount++;
      const ok =
        (pendingLane===0 && cxNorm<=LEFT_COMMIT) ||
        (pendingLane===2 && cxNorm>=RIGHT_COMMIT) ||
        (pendingLane===1 && cxNorm>0.45 && cxNorm<0.55);
      if (ok && persistCount>=PERSIST_FR){
        currentLane=pendingLane; pendingLane=null; persistCount=0;
        targetLane=currentLane; sendLane(currentLane);
      }
    } else { pendingLane=null; persistCount=0; targetLane=currentLane; }
  }

  const hasFace = 'FaceDetector' in window;
  const detector = hasFace ? new FaceDetector({fastMode:true,maxDetectedFaces:1}) : null;

  const W=128, H=96;
  const cvs=document.createElement('canvas'); cvs.width=W; cvs.height=H;
  const ctx=cvs.getContext('2d',{willReadFrequently:true});
  let prev=null, prevCxNorm=null, prevTs=null;

  function avgLuma(imgData){
    const d=imgData.data; let s=0, n=0;
    for(let i=0;i<d.length;i+=4){ s += (0.2126*d[i] + 0.7152*d[i+1] + 0.0722*d[i+2]); n++; }
    return s/n;
  }

  function motionHeadCenter(){
    if (MIRROR){ ctx.save(); ctx.scale(-1,1); ctx.drawImage(video,-W,0,W,H); ctx.restore(); }
    else { ctx.drawImage(video,0,0,W,H); }
    const img=ctx.getImageData(0,0,W,H), d=img.data;
    const y0=Math.floor(H*ROI_Y_MIN), y1=Math.floor(H*ROI_Y_MAX);
    let sum=0,sumX=0,pix=0;
    if(prev && prev.length===d.length){
      for(let y=y0;y<y1;y++){
        for(let x=0;x<W;x++){
          const i=(y*W+x)*4;
          const diff = (Math.abs(d[i]-prev[i])+Math.abs(d[i+1]-prev[i+1])+Math.abs(d[i+2]-prev[i+2]))/3;
          if (diff>18){ sum+=diff; sumX+=diff*x; pix++; }
        }
      }
    }
    prev = new Uint8ClampedArray(d);
    const roiPixels = W*(y1-y0);
    const area = pix/roiPixels;
    if (area < MIN_BLOB_AREA) return null;

    const cx = sum ? (sumX/sum) : null;
    if (cx==null) return null;
    const now = performance.now();
    const cxNorm = cx/W;

    let okSpeed = true;
    if (prevCxNorm!=null && prevTs!=null){
      const dt = Math.max(1, now-prevTs);
      const v = Math.abs(cxNorm - prevCxNorm) / dt; // per ms
      okSpeed = v >= SPEED_THRESH/1000;
    }
    prevCxNorm=cxNorm; prevTs=now;
    if (!okSpeed) return null;
    return cxNorm;
  }

  async function loop(){
    if(!enabled||!stream) return;
    try{
      let usedFace = false;
      ctx.drawImage(video,0,0,W,H);
      const luma = avgLuma(ctx.getImageData(0,0,W,H));
      const enoughLight = luma >= LUMA_MIN;

      if (hasFace && enoughLight){
        const faces = await detector.detect(video);
        if (faces && faces.length){
          const f = faces[0].boundingBox;
          let cx = f.x + f.width/2;
          const vw=video.videoWidth||640;
          let cxNorm=cx/vw; if(MIRROR) cxNorm = 1 - cxNorm;
          smoothX = smoothX + SMOOTH_ALPHA*(cxNorm - smoothX);
          commitLane(smoothX);
          lastLockTs = performance.now();
          usedFace = true;
        }
      }
      if (!usedFace){
        clearOverlay();
        const cxNorm = motionHeadCenter();
        if (cxNorm!=null){
          smoothX = smoothX + SMOOTH_ALPHA*(cxNorm - smoothX);
          commitLane(smoothX);
          lastLockTs = performance.now();
        }
      }
    }catch(e){}
    rafId = requestAnimationFrame(loop);
  }

  async function heartbeat(){
    if(!enabled||!stream) return;
    const now = performance.now();
    if (now - lastLockTs <= 450){ sendLane(currentLane); return; }

    try{
      if (hasFace){
        const faces = await detector.detect(video);
        if (faces && faces.length){
          const f=faces[0].boundingBox;
          let cx=f.x+f.width/2, vw=video.videoWidth||640;
          let cxNorm=cx/vw; if(MIRROR) cxNorm=1-cxNorm;
          smoothX = smoothX + 0.6*(cxNorm - smoothX);
          commitLane(smoothX);
          lastLockTs = now; return;
        }
      }
      const cxNorm = motionHeadCenter();
      if (cxNorm!=null){
        smoothX = smoothX + 0.6*(cxNorm - smoothX);
        commitLane(smoothX);
        lastLockTs = now; return;
      }
    }catch(e){}
    sendLane(currentLane);
  }

  function watchdog(){
    if(!enabled||!stream) return;
    const gameLane = window.__GAME__?.getLane?.();
    if (typeof gameLane==='number' && gameLane!==targetLane){
      sendLane(targetLane);
    }
  }

  async function enable(){
    if(enabled) return;
    try{
      stream = await navigator.mediaDevices.getUserMedia({ video:{ facingMode:'user' }, audio:false });
      video.srcObject = stream;

      camPreview.srcObject = stream;
      // camWrap.style.display = 'block'; // ‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏≠‡∏¢‡∏≤‡∏Å debug

      if (camFullVid){
        camFullVid.srcObject = stream;
        await camFullVid.play().catch(()=>{});
        camFull.style.display = 'block';
      }
      await video.play().catch(()=>{}); await camPreview.play().catch(()=>{});

      enabled=true; motionBtn.innerText='üì∑: On';
      clearOverlay();
      prev=null; prevCxNorm=null; prevTs=null; pendingLane=null; persistCount=0; targetLane=currentLane; lastLockTs=0;
      cancelAnimationFrame(rafId); rafId=requestAnimationFrame(loop);
      clearInterval(heartbeatId); heartbeatId=setInterval(heartbeat, 500);
      clearInterval(watchdogId);  watchdogId=setInterval(watchdog, 300);
    }catch(err){
      alert('‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ: '+(err?.message||err));
    }
  }
  function disable(){
    enabled=false; motionBtn.innerText='üì∑: Off';
    cancelAnimationFrame(rafId);
    clearInterval(heartbeatId); clearInterval(watchdogId);
    if(stream){ stream.getTracks().forEach(t=>t.stop()); stream=null; }
    video.srcObject=null;
    camPreview.pause?.(); camPreview.srcObject=null;
    if (camFullVid){ camFullVid.pause?.(); camFullVid.srcObject=null; }
    if (camFull){ camFull.style.display='none'; }
    clearOverlay();
    if (camWrap) camWrap.style.display='none';
  }

  motionBtn.addEventListener('click', ()=>{ enabled?disable():enable(); });
  window.addEventListener('beforeunload', disable);

  if(!window.__GAME__) window.__GAME__ = {};
  if(!window.__GAME__.__isRunning) window.__GAME__.__isRunning = ()=>true;
})();
</script>

<!-- ====== ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏Å‡∏° (‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ö‡∏ô #stage ‡∏î‡∏µ‡πÑ‡∏ã‡∏ô‡πå‡∏ü‡∏¥‡∏Å‡∏ã‡πå) ====== -->
<script>
(() => {
  const DESIGN_W = 1280, DESIGN_H = 720;           // ‡∏Ç‡∏ô‡∏≤‡∏î‡∏î‡∏µ‡πÑ‡∏ã‡∏ô‡πå
  const stage = document.getElementById('stage');   // <- ‡πÄ‡∏ß‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏™‡πÄ‡∏Å‡∏•
  const game = document.getElementById('game');
  const timerEl = document.getElementById('timer');
  const overlay = document.getElementById('overlay');
  const endTitleEl = document.getElementById('endTitle');
  const finalScoreEl = document.getElementById('finalScore');
  const restartBtn = document.getElementById('restartBtn');
  const quickRestart = document.getElementById('quickRestart');
  const selectLevelBtn = document.getElementById('selectLevelBtn');
  const nextLevelBtn = document.getElementById('nextLevelBtn');

  const hitSound = document.getElementById('hitSound');
  const theWin = document.getElementById('winSound');
  const bgm = document.getElementById('bgm');

  if (hitSound) { hitSound.src = "image/fruit.mp3"; hitSound.volume = 1.0; }
  if (theWin)   { theWin.src  = "image/win2.mp3";  theWin.volume  = 1.0; }
  if (bgm)      { bgm.volume  = 0.35; }

  const BGM_TRACKS = ["image/bgm4.mp3","image/bgm5.mp3","image/bgm6.mp3"];
  let bgmIndex = 0;
  function playBgm(){
    if (!bgm || !BGM_TRACKS.length) return;
    bgm.src = BGM_TRACKS[bgmIndex];
    bgm.currentTime = 0;
    bgm.play().catch(()=>{});
    bgm.onended = () => { bgmIndex = (bgmIndex + 1) % BGM_TRACKS.length; playBgm(); };
  }

  const startScreen  = document.getElementById('startScreen');
  const startTitle   = document.getElementById('startTitle');
  const startBtn     = document.getElementById('startBtn');
  const countdownEl  = document.getElementById('countdown');

  function openStartForLevel(autoCountdown = true){
    const L = LEVELS[selectedLevel];
    if(startTitle){
      startTitle.textContent = (L && L.mission) ? L.mission : `‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à: ${L?.name || ''}`;
    }
    if(startScreen) startScreen.style.display = 'flex';
    if(startBtn) startBtn.style.display = 'none';
    if(!autoCountdown) return;
    if(countdownEl){
      let n = 3;
      countdownEl.textContent = n;
      countdownEl.style.display = 'block';
      const itv = setInterval(() => {
        n--;
        if(n > 0){ countdownEl.textContent = n; }
        else{
          clearInterval(itv);
          if(startScreen) startScreen.style.display = 'none';
          startGame();
        }
      }, 1000);
    }
  }

  const wrongListEl = document.getElementById('wrongList');
  const wrongBoxEl  = document.querySelector('.wrong-box');

  const kid = document.getElementById('kid');
  const ruleLabelEl = document.getElementById('ruleLabel');

  const scoreFill = document.getElementById('scoreFill');
  const scoreText = document.getElementById('scoreText');
  const scoreFruit = document.getElementById('scoreFruit');
  const fruits = ["üçé","üçå","üçá","üçâ","üçç","üçì","üçë","üçí","ü•≠","ü´ê","ü•ù","üçê","üçä"];

  /* ====== ‡∏Ñ‡∏≠‡∏ô‡∏ü‡∏¥‡∏Å‡∏î‡πà‡∏≤‡∏ô ====== */
  const BASE1_CORRECT = ["‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ","‡∏û‡∏¢‡∏±‡∏Ñ‡∏Ü‡πå","‡∏ß‡∏¥‡∏´‡∏Ñ","‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ","‡∏†‡∏≤‡∏Ñ","‡∏ó‡∏∏‡∏Å‡∏Ç‡πå","‡∏Ñ‡∏∂‡∏Å‡∏Ñ‡∏±‡∏Å","‡πÄ‡∏•‡∏Ç","‡πÇ‡∏ä‡∏Ñ","‡πÄ‡∏°‡∏Ü","‡πÇ‡∏£‡∏Ñ","‡∏™‡∏∏‡∏Ç","‡∏°‡∏∏‡∏Ç‡∏ï‡∏•‡∏Å","‡∏´‡∏°‡∏ß‡∏Å","‡∏û‡∏£‡∏£‡∏Ñ","‡πÇ‡∏®‡∏Å‡πÄ‡∏®‡∏£‡πâ‡∏≤","‡∏¢‡∏±‡∏Å‡∏©‡πå","‡∏Ñ‡∏∏‡∏Å","‡∏®‡∏∏‡∏Å‡∏£‡πå","‡∏ú‡∏π‡∏Å","‡∏®‡∏≠‡∏Å","‡∏ô‡∏≤‡∏Ñ","‡∏ô‡∏≤‡∏Å","‡∏à‡∏∏‡∏Å‡∏à‡∏¥‡∏Å","‡∏ö‡∏∏‡∏Å‡πÄ‡∏ö‡∏¥‡∏Å","‡πÄ‡∏•‡∏¥‡∏Å","‡∏¢‡∏±‡∏Å‡∏¢‡∏≠‡∏Å","‡πÄ‡∏´‡∏¢‡∏∑‡∏≠‡∏Å","‡∏ó‡∏≤‡∏Å","‡∏û‡∏±‡∏Å‡∏ï‡∏£‡πå","‡πÄ‡∏ú‡∏∑‡∏≠‡∏Å","‡∏õ‡∏•‡∏π‡∏Å","‡πÄ‡∏ä‡∏∑‡∏≠‡∏Å","‡∏™‡∏∞‡∏î‡∏ß‡∏Å","‡πÅ‡∏õ‡∏•‡∏Å‡πÅ‡∏¢‡∏Å","‡πÄ‡∏î‡πá‡∏Å","‡∏´‡∏á‡∏≠‡∏Å","‡∏â‡∏µ‡∏Å","‡∏Å‡∏£‡∏∞‡∏ä‡∏≤‡∏Å","‡πÇ‡∏•‡∏Å","‡∏ö‡∏£‡∏¥‡πÇ‡∏†‡∏Ñ","‡∏≠‡∏¢‡∏≤‡∏Å","‡∏™‡∏ô‡∏∏‡∏Å","‡∏â‡∏•‡∏≤‡∏Å","‡∏®‡∏±‡∏Å‡∏î‡∏¥‡πå‡∏®‡∏£‡∏µ","‡∏ú‡∏±‡∏Å","‡∏•‡∏ß‡∏Å","‡∏ä‡∏Å","‡∏Å‡∏£‡∏∞‡∏î‡∏π‡∏Å","‡∏Å‡∏£‡∏∞‡∏î‡∏Å","‡∏ü‡∏±‡∏Å","‡∏ô‡∏Å","‡∏ï‡∏Å‡πÉ‡∏à","‡∏´‡∏¢‡∏¥‡∏Å","‡∏û‡∏±‡∏Å","‡∏î‡∏Å","‡∏´‡∏°‡∏≤‡∏Å","‡πÄ‡∏õ‡∏•‡∏∑‡∏≠‡∏Å","‡∏ä‡∏≠‡∏•‡πå‡∏Å","‡∏´‡∏°‡∏±‡∏Å","‡∏™‡∏∏‡∏ô‡∏±‡∏Ç","‡∏ô‡∏≠‡∏Å‡∏Ñ‡∏≠‡∏Å","‡∏à‡∏°‡∏π‡∏Å","‡πÅ‡∏ï‡∏Å‡πÅ‡∏¢‡∏Å"];
  const BASE1_WRONG = ["‡∏û‡∏∑‡∏ä","‡∏ï‡∏≥‡∏£‡∏ß‡∏à","‡∏Å‡∏≠‡∏î","‡∏û‡∏π‡∏î","‡∏´‡∏°‡∏≤‡∏¢","‡∏Å‡∏£‡∏£‡∏°","‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó","‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï","‡∏Å‡∏≥‡∏´‡∏ô‡∏î","‡∏õ‡∏£‡∏≤‡∏Å‡∏è","‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®","‡πÇ‡∏≠‡∏Å‡∏≤‡∏™","‡∏û‡∏¥‡∏©","‡∏ç‡∏≤‡∏ï‡∏¥","‡∏û‡∏∏‡∏ó‡∏ò","‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©","‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå","‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ","‡πÇ‡∏Å‡∏£‡∏ò","‡πÇ‡∏õ‡∏£‡∏î","‡∏£‡∏ñ","‡∏£‡∏™","‡∏û‡∏±‡∏î","‡∏≠‡∏¥‡∏ê","‡∏ö‡∏±‡∏ï‡∏£","‡∏ö‡∏≤‡∏î","‡∏õ‡∏¥‡∏î","‡πÄ‡∏õ‡∏¥‡∏î","‡∏õ‡∏•‡∏î","‡∏õ‡∏•‡∏¥‡∏î","‡∏û‡∏•‡∏≤‡∏î","‡∏û‡∏±‡∏ö","‡∏û‡∏±‡∏ö‡πÄ‡∏û‡∏µ‡∏¢‡∏ö","‡∏ü‡∏≤‡∏î","‡∏ü‡∏±‡∏î","‡∏°‡∏±‡∏î","‡∏°‡∏≠‡∏î","‡∏¢‡∏≠‡∏î","‡∏•‡∏≠‡∏î","‡∏•‡∏ß‡∏î","‡∏•‡∏π‡∏î","‡∏≠‡∏ß‡∏î","‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥","‡∏≠‡∏π‡∏ê","‡∏ä‡∏≤‡∏ï‡∏¥","‡∏ö‡∏≤‡∏ó","‡∏ß‡∏≤‡∏¨","‡∏à‡∏≤‡∏ô","‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô","‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ","‡∏ö‡πâ‡∏≤‡∏ô","‡∏ö‡∏¥‡∏ô","‡∏î‡∏¥‡∏ô","‡∏´‡∏¥‡∏ô","‡∏™‡∏ß‡∏ô","‡πÄ‡∏£‡∏µ‡∏¢‡∏ô","‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì","‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£","‡πÇ‡∏ö‡∏£‡∏≤‡∏ì","‡∏ß‡∏±‡∏ô‡πÄ‡∏û‡πá‡∏ç","‡∏ó‡∏´‡∏≤‡∏£","‡∏£‡∏∏‡πà‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏á","‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏±‡∏ß","‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠","‡∏•‡∏î","‡πÄ‡∏û‡∏¥‡πà‡∏°","‡∏™‡∏±‡∏ö","‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô","‡∏õ‡∏£‡∏≤‡∏™‡∏≤‡∏ó","‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå","‡∏®‡∏û","‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå","‡∏ä‡∏≠‡∏ö","‡∏°‡∏≠‡∏ö","‡∏´‡∏°‡∏≠‡∏ö","‡πÇ‡∏•‡∏†","‡∏ó‡∏±‡∏û‡∏û‡∏µ","‡∏Å‡∏≠‡∏•‡πå‡∏ü","‡∏¢‡∏µ‡∏£‡∏≤‡∏ü","‡∏ö‡∏≤‡∏õ","‡∏£‡∏π‡∏õ","‡∏≠‡∏û‡∏¢‡∏û"];

  const BASE2_CORRECT = ["‡∏û‡∏∑‡∏ä","‡∏ï‡∏≥‡∏£‡∏ß‡∏à","‡∏Å‡∏≠‡∏î","‡∏û‡∏π‡∏î","‡∏à‡∏≠‡∏î‡∏£‡∏ñ","‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥","‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó","‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï","‡∏Å‡∏≥‡∏´‡∏ô‡∏î","‡∏õ‡∏£‡∏≤‡∏Å‡∏è","‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®","‡πÇ‡∏≠‡∏Å‡∏≤‡∏™","‡∏û‡∏¥‡∏©","‡∏Å‡∏é","‡∏û‡∏∏‡∏ó‡∏ò","‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©","‡∏ä‡∏≤‡∏ï‡∏¥","‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ","‡πÇ‡∏Å‡∏£‡∏ò","‡πÇ‡∏õ‡∏£‡∏î","‡∏ö‡∏±‡∏ï‡∏£","‡∏£‡∏™‡∏ä‡∏≤‡∏ï‡∏¥","‡∏û‡∏±‡∏î","‡∏≠‡∏¥‡∏ê","‡∏ñ‡∏ô‡∏±‡∏î","‡∏ö‡∏≤‡∏î","‡∏õ‡∏¥‡∏î","‡πÄ‡∏õ‡∏¥‡∏î","‡∏õ‡∏•‡∏î","‡∏õ‡∏•‡∏¥‡∏î","‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î","‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå","‡∏ö‡∏£‡∏¥‡∏™‡∏∏‡∏ó‡∏ò‡∏¥‡πå","‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó","‡∏ü‡∏≤‡∏î","‡∏ü‡∏±‡∏î","‡∏°‡∏±‡∏î","‡∏°‡∏≠‡∏î","‡∏¢‡∏≠‡∏î","‡πÄ‡∏•‡∏∑‡∏≠‡∏î","‡∏•‡∏ß‡∏î","‡∏£‡∏±‡∏ê","‡∏≠‡∏ß‡∏î","‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥","‡∏≠‡∏π‡∏ê","‡∏™‡∏±‡∏ï‡∏ß‡πå","‡∏ç‡∏≤‡∏ï‡∏¥","‡∏°‡∏µ‡∏î‡∏ö‡∏≤‡∏î","‡∏ó‡∏¥‡∏®","‡∏™‡∏°‡∏∏‡∏î","‡πÄ‡∏Å‡∏©‡∏ï‡∏£","‡πÄ‡∏û‡∏®","‡∏≠‡∏≤‡∏Å‡∏≤‡∏®","‡∏ï‡∏•‡∏≤‡∏î","‡∏ï‡∏•‡∏≠‡∏î","‡∏™‡∏ô‡∏¥‡∏ó","‡πÄ‡∏™‡∏î‡πá‡∏à","‡πÄ‡∏ú‡πá‡∏î","‡∏Ç‡∏µ‡πâ‡πÄ‡∏Å‡∏µ‡∏¢‡∏à","‡πÄ‡∏Å‡∏•‡∏µ‡∏¢‡∏î","‡πÇ‡∏Å‡∏£‡∏ò","‡∏õ‡∏£‡∏∞‡∏î‡∏∏‡∏à","‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏","‡∏û‡∏¢‡∏≤‡∏ò‡∏¥","‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå","‡∏Ñ‡∏£‡∏∏‡∏ë","‡∏õ‡∏£‡∏≤‡∏™‡∏≤‡∏ó","‡∏≠‡∏≤‡∏û‡∏≤‡∏ò","‡∏ï‡∏£‡∏ß‡∏à","‡πÄ‡∏ó‡πá‡∏à","‡∏ö‡∏≥‡πÄ‡∏´‡∏ô‡πá‡∏à","‡∏™‡∏≥‡∏£‡∏ß‡∏à","‡∏≠‡∏¥‡∏à‡∏â‡∏≤","‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à","‡∏ç‡∏≤‡∏ï‡∏¥","‡πÄ‡∏û‡∏ä‡∏£","‡∏ö‡∏ß‡∏ä","‡∏Å‡πä‡∏≤‡∏ã","‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå","‡∏≠‡∏≤‡∏ß‡∏∏‡∏ò","‡∏û‡∏¥‡∏®‡∏ß‡∏≤‡∏™","‡πÄ‡∏®‡∏©","‡πÄ‡∏Ç‡∏ï","‡∏§‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏î‡∏ä"];
  const BASE2_WRONG   = ["‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ","‡∏û‡∏¢‡∏±‡∏Ñ‡∏Ü‡πå","‡∏ß‡∏¥‡∏´‡∏Ñ","‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ","‡∏†‡∏≤‡∏Ñ","‡∏ó‡∏∏‡∏Å‡∏Ç‡πå","‡∏Ñ‡∏∂‡∏Å‡∏Ñ‡∏±‡∏Å","‡∏£‡∏≤‡∏Ñ‡∏≤","‡πÇ‡∏ä‡∏Ñ","‡πÄ‡∏°‡∏Ü","‡πÇ‡∏£‡∏Ñ","‡∏™‡∏∏‡∏Ç","‡∏°‡∏∏‡∏Ç‡∏ï‡∏•‡∏Å","‡∏´‡∏°‡∏ß‡∏Å","‡∏û‡∏£‡∏£‡∏Ñ","‡πÄ‡∏•‡∏Ç","‡∏¢‡∏±‡∏Å‡∏©‡πå","‡∏Ñ‡∏∏‡∏Å","‡∏®‡∏∏‡∏Å‡∏£‡πå","‡∏ú‡∏π‡∏Å","‡∏®‡∏≠‡∏Å","‡∏ô‡∏≤‡∏Ñ","‡∏ô‡∏≤‡∏Å","‡∏à‡∏∏‡∏Å‡∏à‡∏¥‡∏Å","‡∏ö‡∏∏‡∏Å‡πÄ‡∏ö‡∏¥‡∏Å","‡πÄ‡∏•‡∏¥‡∏Å","‡∏¢‡∏±‡∏Å‡∏¢‡∏≠‡∏Å","‡πÄ‡∏´‡∏¢‡∏∑‡∏≠‡∏Å","‡∏ó‡∏≤‡∏Å","‡∏û‡∏±‡∏Å‡∏ï‡∏£‡πå","‡πÄ‡∏ú‡∏∑‡∏≠‡∏Å","‡∏õ‡∏•‡∏π‡∏Å","‡πÄ‡∏ä‡∏∑‡∏≠‡∏Å","‡∏™‡∏∞‡∏î‡∏∑‡∏≠","‡πÅ‡∏õ‡∏•‡∏Å‡πÅ‡∏¢‡∏Å","‡πÄ‡∏î‡πá‡∏Å","‡∏´‡∏á‡∏≠‡∏Å","‡∏â‡∏µ‡∏Å","‡∏Å‡∏£‡∏∞‡∏ä‡∏≤‡∏Å","‡πÇ‡∏•‡∏Å","‡∏ö‡∏£‡∏¥‡πÇ‡∏†‡∏Ñ","‡∏≠‡∏¢‡∏≤‡∏Å","‡∏™‡∏ô‡∏∏‡∏Å","‡∏â‡∏•‡∏≤‡∏Å","‡∏ô‡∏≤‡∏ó‡∏µ","‡∏ú‡∏±‡∏Å","‡∏•‡∏ß‡∏Å","‡∏ä‡∏Å","‡∏Å‡∏£‡∏∞‡∏î‡∏π‡∏Å","‡πÄ‡∏¢‡∏∑‡πà‡∏≠‡πÉ‡∏¢","‡∏ü‡∏±‡∏Å","‡∏ô‡∏Å","‡∏ï‡∏Å‡πÉ‡∏à","‡∏´‡∏¢‡∏¥‡∏Å","‡∏û‡∏±‡∏Å","‡∏î‡∏Å","‡∏≠‡∏Å","‡πÄ‡∏õ‡∏•‡∏∑‡∏≠‡∏Å","‡∏ß‡∏≤‡∏¨","‡∏à‡∏≤‡∏ô","‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô","‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ","‡∏ö‡πâ‡∏≤‡∏ô","‡∏ö‡∏¥‡∏ô","‡∏î‡∏¥‡∏ô","‡∏´‡∏¥‡∏ô","‡∏™‡∏ß‡∏ô","‡πÄ‡∏£‡∏µ‡∏¢‡∏ô","‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì","‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£","‡πÇ‡∏ö‡∏£‡∏≤‡∏ì","‡∏ß‡∏±‡∏ô‡πÄ‡∏û‡πá‡∏ç","‡∏ó‡∏´‡∏≤‡∏£","‡∏ö‡∏∏‡∏ç‡∏Ñ‡∏∏‡∏ì","‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå","‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£","‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏ú‡πâ‡∏≤","‡∏°‡∏π‡∏°‡∏°‡∏≤‡∏°","‡πÄ‡∏û‡∏µ‡∏¢‡∏£","‡∏Ñ‡∏ô‡∏û‡∏≤‡∏•","‡∏≠‡∏≤‡∏´‡∏≤‡∏£","‡∏ï‡∏≥‡∏ô‡∏≤‡∏ô","‡∏™‡∏°‡∏∏‡∏ô","‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡πÄ‡∏à‡∏≤‡∏∞","‡∏•‡πâ‡∏≠","‡∏ï‡πâ‡∏ô‡∏ï‡∏≤‡∏•","‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå","‡πÄ‡∏´‡∏°‡πá‡∏ô","‡∏°‡∏∞‡∏°‡πà‡∏ß‡∏á"];

  const BASE3_CORRECT = ["‡∏Å‡∏¥‡∏ô","‡∏Ñ‡∏ô","‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•","‡∏ú‡∏•‡πÑ‡∏°‡πâ","‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô","‡∏ô‡∏≠‡∏ô","‡πÄ‡∏Ç‡πá‡∏ô","‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•","‡∏ö‡∏±‡∏ô‡πÑ‡∏î","‡∏™‡∏±‡∏ç‡∏à‡∏£","‡∏û‡∏¥‡∏ì","‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì","‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•","‡∏ß‡∏≤‡∏¨","‡∏à‡∏≤‡∏ô","‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô","‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ","‡∏ö‡πâ‡∏≤‡∏ô","‡∏ö‡∏¥‡∏ô","‡∏£‡πâ‡∏≠‡∏ô‡∏£‡∏ô","‡∏™‡∏ß‡∏ô","‡πÄ‡∏£‡∏µ‡∏¢‡∏ô","‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì","‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£","‡∏ß‡∏±‡∏ô‡πÄ‡∏û‡πá‡∏ç","‡∏ó‡∏´‡∏≤‡∏£","‡∏õ‡∏±‡∏ç‡∏ç‡∏≤","‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå","‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£","‡∏•‡∏≥‡∏ò‡∏≤‡∏£","‡∏ö‡∏∏‡∏ç‡∏Ñ‡∏∏‡∏ì","‡πÄ‡∏û‡∏µ‡∏¢‡∏£","‡∏Ñ‡∏ô‡∏û‡∏≤‡∏•","‡∏≠‡∏≤‡∏´‡∏≤‡∏£","‡∏ï‡∏≥‡∏ô‡∏≤‡∏ô","‡∏™‡∏°‡∏∏‡∏ô","‡∏ä‡∏≥‡∏ô‡∏≤‡∏ç","‡∏°‡∏≤‡∏£","‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå","‡πÄ‡∏´‡∏°‡πá‡∏ô","‡∏ß‡∏ô‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô","‡∏ä‡∏∏‡∏•‡∏°‡∏∏‡∏ô","‡∏ß‡∏¥‡∏ì‡∏ç‡∏≤‡∏ì","‡∏ó‡∏°‡∏¥‡∏¨","‡πÄ‡∏ì‡∏£","‡πÇ‡∏ö‡∏£‡∏≤‡∏ì","‡∏™‡∏±‡πà‡∏ô‡∏Ñ‡∏•‡∏≠‡∏ô","‡∏≠‡∏±‡∏ç‡∏ä‡∏±‡∏ô","‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç","‡∏Å‡∏≤‡∏£‡∏Ñ‡∏π‡∏ì","‡∏´‡∏°‡∏∑‡πà‡∏ô‡πÅ‡∏™‡∏ô","‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì","‡∏ñ‡πà‡∏≤‡∏ô‡∏´‡∏¥‡∏ô","‡∏™‡∏∏‡∏ß‡∏£‡∏£‡∏ì","‡∏û‡∏£‡∏£‡∏©‡∏≤","‡πÄ‡∏Å‡∏™‡∏£","‡∏Å‡∏∏‡∏ç‡∏ä‡∏£","‡∏Å‡πâ‡∏≠‡∏ô‡∏´‡∏¥‡∏ô","‡∏Å‡∏£‡∏∞‡πÄ‡∏î‡πá‡∏ô","‡∏â‡∏±‡∏ô‡πÄ‡∏û‡∏•","‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô","‡∏´‡∏£‡∏£‡∏©‡∏≤","‡∏ß‡∏±‡∏ô‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå","‡∏®‡∏µ‡∏•","‡∏®‡∏≤‡∏•","‡∏°‡∏ß‡∏•‡∏™‡∏≤‡∏£"];
  const BASE3_WRONG   = ["‡∏Å‡∏ö","‡∏à‡∏ö","‡∏´‡∏±‡∏ö","‡∏Å‡∏£‡∏≤‡∏ö","‡∏Å‡∏•‡∏±‡∏ö","‡∏Ñ‡∏≤‡∏õ‡∏¥‡∏ö‡∏≤‡∏£‡πà‡∏≤","‡∏ó‡∏±‡∏û","‡∏®‡∏±‡∏û‡∏ó‡πå","‡∏†‡∏≤‡∏û","‡∏Å‡∏£‡∏≤‡∏ü","‡∏•‡∏µ‡∏ü","‡∏ó‡∏£‡∏≤‡∏ö","‡∏Ç‡πà‡∏≤‡∏ß","‡∏õ‡∏£‡∏∞‡∏ó‡∏±‡∏ö","‡∏ó‡∏≤‡∏™","‡∏≠‡∏ß‡∏Å‡∏≤‡∏®","‡πÉ‡∏ö‡πÄ‡∏ï‡∏¢","‡∏Å‡∏•‡πà‡∏≠‡∏á","‡∏™‡∏°‡∏≠‡∏á","‡∏™‡∏°‡∏±‡∏¢","‡∏â‡∏•‡∏≤‡∏Å","‡∏â‡∏•‡∏≠‡∏á","‡∏û‡∏¥‡∏û‡∏≤‡∏ó","‡∏õ‡∏£‡∏±‡∏ö","‡∏õ‡∏•‡∏≠‡∏°","‡∏Å‡∏≥‡∏´‡∏ô‡∏î","‡∏õ‡∏£‡∏≤‡∏Å‡∏è","‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®","‡πÇ‡∏≠‡∏Å‡∏≤‡∏™","‡∏û‡∏¥‡∏©","‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢","‡∏û‡∏∏‡∏ó‡∏ò","‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©","‡∏ú‡∏•‡∏¥‡∏ï","‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ","‡πÇ‡∏Å‡∏£‡∏ò","‡πÇ‡∏õ‡∏£‡∏î","‡∏£‡∏ñ","‡∏£‡∏™","‡∏û‡∏±‡∏î","‡∏≠‡∏¥‡∏ê","‡∏ö‡∏±‡∏ï‡∏£","‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ","‡∏û‡∏¢‡∏±‡∏Ñ‡∏Ü‡πå","‡∏ß‡∏¥‡∏´‡∏Ñ","‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ","‡∏†‡∏≤‡∏Ñ","‡∏ó‡∏∏‡∏Å‡∏Ç‡πå","‡∏Ñ‡∏∂‡∏Å‡∏Ñ‡∏±‡∏Å","‡πÄ‡∏•‡∏Ç","‡πÇ‡∏ä‡∏Ñ","‡πÄ‡∏°‡∏Ü","‡πÇ‡∏£‡∏Ñ","‡∏™‡∏∏‡∏Ç","‡∏°‡∏∏‡∏Ç‡∏ï‡∏•‡∏Å","‡∏´‡∏°‡∏ß‡∏Å","‡∏ß‡∏±‡∏á‡πÄ‡∏ß‡∏á","‡πÅ‡∏°‡∏ß‡∏ô‡πâ‡∏≥","‡∏Ñ‡∏•‡∏∏‡∏Å‡πÄ‡∏Ñ‡∏•‡πâ‡∏≤","‡∏®‡∏∏‡∏Å‡∏£‡πå","‡∏ú‡∏π‡∏Å","‡∏®‡∏≠‡∏Å","‡∏ô‡∏≤‡∏Ñ","‡∏ô‡∏≤‡∏Å","‡∏à‡∏∏‡∏Å‡∏à‡∏¥‡∏Å","‡∏Æ‡∏¥‡∏õ‡πÇ‡∏õ","‡πÄ‡∏•‡∏¥‡∏Å","‡∏¢‡∏±‡∏Å‡∏¢‡∏≠‡∏Å","‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ","‡∏ó‡∏∏‡∏á‡∏ó‡∏∏‡∏á‡∏ó‡∏∏‡∏á ‡∏ã‡∏≤‡∏Æ‡∏π‡∏£‡πå ","‡∏™‡∏±‡∏ö‡∏õ‡∏∞‡∏£‡∏î","‡∏°‡∏∞‡∏£‡∏∞","‡πÄ‡∏û‡∏®","‡∏®‡∏û","‡∏ò‡∏£‡∏£‡∏°‡∏∞","‡∏ó‡∏≠‡∏á‡∏Ñ‡∏≥","‡∏°‡∏≠‡∏ö","‡∏´‡∏°‡∏≠‡∏ö","‡∏Å‡∏∞‡πÄ‡∏û‡∏£‡∏≤","‡∏ó‡∏±‡∏û‡∏û‡∏µ","‡∏Å‡∏≠‡∏•‡πå‡∏ü","‡∏ö‡∏≤‡∏õ","‡∏£‡∏π‡∏õ","‡∏°‡∏±‡∏á‡∏Ñ‡∏∏‡∏î","‡∏•‡∏≠‡∏á‡∏Å‡∏≠‡∏á"];

  const BASE4_CORRECT = ["‡∏Å‡∏ö","‡∏à‡∏ö","‡∏´‡∏±‡∏ö","‡∏Å‡∏£‡∏≤‡∏ö","‡∏Å‡∏•‡∏±‡∏ö","‡∏Å‡∏•‡∏±‡∏ö‡∏ö‡πâ‡∏≤‡∏ô","‡∏ó‡∏±‡∏û","‡∏®‡∏±‡∏û‡∏ó‡πå","‡∏†‡∏≤‡∏û","‡∏Å‡∏£‡∏≤‡∏ü","‡∏ó‡∏ß‡∏µ‡∏õ","‡∏ó‡∏£‡∏≤‡∏ö","‡∏ö‡∏≤‡∏õ","‡∏õ‡∏£‡∏∞‡∏ó‡∏±‡∏ö","‡∏õ‡∏£‡∏∞‡∏ó‡∏±‡∏ö","‡∏ó‡∏∞‡πÄ‡∏•‡∏™‡∏≤‡∏ö","‡πÄ‡∏Ñ‡∏•‡∏∑‡∏≠‡∏ö","‡∏à‡∏π‡∏ö","‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö","‡πÅ‡∏™‡∏ö","‡∏£‡∏ß‡∏ö","‡πÅ‡∏≠‡∏ö","‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö","‡∏õ‡∏£‡∏±‡∏ö","‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå","‡∏≠‡∏≤‡∏ö‡∏ô‡πâ‡∏≥","‡∏ã‡∏∏‡∏ö‡∏ã‡∏¥‡∏ö","‡∏Ñ‡∏≥‡∏™‡∏≤‡∏õ","‡∏´‡∏µ‡∏ö","‡∏™‡∏±‡∏ö","‡∏ä‡∏≠‡∏ö","‡∏´‡∏≤‡∏ö","‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå","‡∏®‡∏û","‡∏£‡∏π‡∏õ","‡∏î‡∏≤‡∏ö","‡∏°‡∏≠‡∏ö","‡∏´‡∏°‡∏≠‡∏ö","‡πÇ‡∏•‡∏†","‡∏ó‡∏±‡∏û‡∏û‡∏µ","‡∏Å‡∏≠‡∏•‡πå‡∏ü","‡∏¢‡∏µ‡∏£‡∏≤‡∏ü","‡∏´‡∏ô‡∏µ‡∏ö","‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û","‡∏≠‡∏û‡∏¢‡∏û","‡∏≠‡∏≤‡∏ä‡∏µ‡∏û","‡πÄ‡∏´‡πá‡∏ö","‡πÄ‡∏•‡πá‡∏ö‡∏°‡∏∑‡∏≠","‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö","‡∏ò‡∏π‡∏õ","‡∏£‡∏≠‡∏ö‡∏Ñ‡∏≠‡∏ö","‡πÄ‡∏´‡∏¢‡∏µ‡∏¢‡∏ö","‡∏Å‡∏ö","‡∏ï‡∏∞‡πÄ‡∏Å‡∏µ‡∏¢‡∏ö","‡πÄ‡∏Ñ‡∏≤‡∏£‡∏û","‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå","‡∏Å‡∏£‡∏∞‡∏™‡∏≠‡∏ö","‡∏™‡∏∏‡∏†‡∏≤‡∏û","‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö","‡∏´‡∏∏‡∏ö‡πÄ‡∏Ç‡∏≤","‡∏ö‡∏ß‡∏ö","‡∏•‡∏¥‡∏ü‡∏ï‡πå","‡∏´‡∏¢‡∏¥‡∏ö‡∏à‡∏±‡∏ö","‡∏™‡∏π‡∏ö","‡∏Ñ‡∏•‡∏¥‡∏õ","‡∏†‡∏û","‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö","‡∏Ñ‡∏±‡∏ö‡πÅ‡∏Ñ‡∏ö","‡∏•‡∏û‡∏ö‡∏∏‡∏£‡∏µ","‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö","‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö","‡∏à‡∏≠‡∏ö","‡∏ï‡∏∞‡∏Ç‡∏≤‡∏ö","‡πÅ‡∏´‡∏ö","‡∏™‡∏•‡∏±‡∏ö","‡∏•‡∏≤‡∏†","‡∏™‡∏£‡∏∏‡∏õ"];
  const BASE4_WRONG   = ["‡∏û‡∏∑‡∏ä","‡∏ï‡∏≥‡∏£‡∏ß‡∏à","‡∏Å‡∏≠‡∏î","‡∏û‡∏π‡∏î","‡πÅ‡∏°‡πà‡∏´‡∏°‡πâ‡∏≤‡∏¢","‡∏ã‡∏∑‡πà‡∏≠‡∏™‡∏±‡∏ï‡∏¢‡πå","‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó","‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï","‡∏Å‡∏≥‡∏´‡∏ô‡∏î","‡∏õ‡∏£‡∏≤‡∏Å‡∏è","‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®","‡πÇ‡∏≠‡∏Å‡∏≤‡∏™","‡∏û‡∏¥‡∏©","‡∏™‡∏±‡∏ï‡∏ß‡πå","‡∏û‡∏∏‡∏ó‡∏ò","‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©","‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå","‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ","‡πÇ‡∏Å‡∏£‡∏ò","‡πÇ‡∏õ‡∏£‡∏î","‡∏£‡∏ñ‡πÑ‡∏ñ","‡∏£‡∏™‡∏ä‡∏≤‡∏ï‡∏¥","‡∏•‡∏°","‡∏≠‡∏¥‡∏ê","‡∏ö‡∏±‡∏ï‡∏£","‡πÄ‡∏î‡πá‡∏Å","‡∏´‡∏á‡∏≠‡∏Å","‡∏â‡∏µ‡∏Å","‡∏Å‡∏£‡∏∞‡∏ä‡∏≤‡∏Å","‡πÇ‡∏•‡∏Å","‡∏ö‡∏£‡∏¥‡πÇ‡∏†‡∏Ñ","‡∏≠‡∏¢‡∏≤‡∏Å","‡∏™‡∏ô‡∏∏‡∏Å","‡∏â‡∏•‡∏≤‡∏Å","‡∏®‡∏±‡∏Å‡∏î‡∏¥‡πå‡∏®‡∏£‡∏µ","‡∏ú‡∏±‡∏Å","‡∏•‡∏ß‡∏Å","‡∏ä‡∏Å","‡∏Å‡∏£‡∏∞‡∏ó‡∏∞","‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤","‡∏ü‡∏±‡∏Å","‡∏ô‡∏Å","‡∏ï‡∏Å‡πÉ‡∏à","‡∏´‡∏¢‡∏¥‡∏Å","‡∏û‡∏±‡∏Å","‡∏Å‡∏£‡∏∞‡∏î‡∏π‡∏Å","‡∏≠‡∏Å‡∏´‡∏±‡∏Å","‡πÄ‡∏õ‡∏•‡∏∑‡∏≠‡∏Å","‡∏ß‡∏≤‡∏¨","‡∏à‡∏≤‡∏ô","‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô","‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ","‡∏ö‡πâ‡∏≤‡∏ô","‡∏ö‡∏¥‡∏ô","‡∏£‡πâ‡∏≠‡∏ô‡∏£‡∏ô","‡∏™‡∏ß‡∏ô","‡πÄ‡∏£‡∏µ‡∏¢‡∏ô","‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì","‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£","‡∏ß‡∏±‡∏ô‡πÄ‡∏û‡πá‡∏ç","‡∏ó‡∏´‡∏≤‡∏£","‡∏õ‡∏±‡∏ç‡∏ç‡∏≤","‡∏™‡∏¥‡∏á‡πÇ‡∏ï","‡∏ï‡∏≤‡∏£‡∏≤‡πÄ‡∏£ ‡∏ï‡∏≤‡∏£‡∏≤‡∏•‡∏≤","‡∏•‡∏≥‡∏ò‡∏≤‡∏£","‡∏ö‡∏∏‡∏ç‡∏Ñ‡∏∏‡∏ì","‡πÄ‡∏û‡∏µ‡∏¢‡∏£","‡∏Ñ‡∏ô‡∏û‡∏≤‡∏•","‡∏≠‡∏≤‡∏´‡∏≤‡∏£","‡∏ï‡∏≥‡∏ô‡∏≤‡∏ô","‡∏°‡∏∞‡∏õ‡∏£‡∏≤‡∏á","‡∏≠‡∏á‡∏∏‡πà‡∏ô","‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß","‡∏û‡∏¥‡∏©","‡∏ó‡∏≤‡∏á‡πÄ‡∏î‡∏¥‡∏ô","‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô","‡πÅ‡∏ß‡πà‡∏ô‡∏ï‡∏≤","‡∏Å‡∏≥‡∏û‡∏£‡πâ‡∏≤","‡∏Å‡πâ‡∏≠‡∏ô‡∏´‡∏¥‡∏ô"];

  const LEVELS = [
    { id:0, name:"‡∏°‡∏≤‡∏ï‡∏£‡∏≤‡∏ï‡∏±‡∏ß‡∏™‡∏∞‡∏Å‡∏î ‡πÅ‡∏°‡πà ‡∏Å‡∏Å", ruleText:"‡πÅ‡∏°‡πà ‡∏Å‡∏Å", mission:"‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à : ‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏™‡∏∞‡∏Å‡∏î‡∏î‡πâ‡∏ß‡∏¢‡∏°‡∏≤‡∏ï‡∏£‡∏≤‡∏ï‡∏±‡∏ß‡∏™‡∏∞‡∏Å‡∏î ‡πÅ‡∏°‡πà ‡∏Å‡∏Å ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö", correctWords:BASE1_CORRECT, wrongWords:BASE1_WRONG },
    { id:1, name:"‡∏°‡∏≤‡∏ï‡∏£‡∏≤‡∏ï‡∏±‡∏ß‡∏™‡∏∞‡∏Å‡∏î ‡πÅ‡∏°‡πà ‡∏Å‡∏î", ruleText:"‡πÅ‡∏°‡πà ‡∏Å‡∏î", mission:"‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à : ‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏™‡∏∞‡∏Å‡∏î‡∏î‡πâ‡∏ß‡∏¢‡∏°‡∏≤‡∏ï‡∏£‡∏≤‡∏ï‡∏±‡∏ß‡∏™‡∏∞‡∏Å‡∏î ‡πÅ‡∏°‡πà ‡∏Å‡∏î ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö", correctWords:BASE2_CORRECT, wrongWords:BASE2_WRONG },
    { id:2, name:"‡∏°‡∏≤‡∏ï‡∏£‡∏≤‡∏ï‡∏±‡∏ß‡∏™‡∏∞‡∏Å‡∏î ‡πÅ‡∏°‡πà ‡∏Å‡∏ô", ruleText:"‡πÅ‡∏°‡πà ‡∏Å‡∏ô", mission:"‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à : ‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏™‡∏∞‡∏Å‡∏î‡∏î‡πâ‡∏ß‡∏¢‡∏°‡∏≤‡∏ï‡∏£‡∏≤‡∏ï‡∏±‡∏ß‡∏™‡∏∞‡∏Å‡∏î ‡πÅ‡∏°‡πà ‡∏Å‡∏ô ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö", correctWords:BASE3_CORRECT, wrongWords:BASE3_WRONG },
    { id:3, name:"‡∏°‡∏≤‡∏ï‡∏£‡∏≤‡∏ï‡∏±‡∏ß‡∏™‡∏∞‡∏Å‡∏î ‡πÅ‡∏°‡πà ‡∏Å‡∏ö", ruleText:"‡πÅ‡∏°‡πà ‡∏Å‡∏ö", mission:"‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à : ‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏™‡∏∞‡∏Å‡∏î‡∏î‡πâ‡∏ß‡∏¢‡∏°‡∏≤‡∏ï‡∏£‡∏≤‡∏ï‡∏±‡∏ß‡∏™‡∏∞‡∏Å‡∏î ‡πÅ‡∏°‡πà ‡∏Å‡∏ö ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö", correctWords:BASE4_CORRECT, wrongWords:BASE4_WRONG },
  ];
  let selectedLevel = 0;

  // ====== ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏∞‡∏™‡∏°‡∏Ç‡πâ‡∏≤‡∏°‡∏î‡πà‡∏≤‡∏ô ======
  let cumulativeScore = 0;
  let roundsPlayed   = 0;
  let lastRunScore   = 0;

  function updateAccum(){
    const el = document.getElementById('accumVal');
    if(el) el.textContent = cumulativeScore.toString();
  }

  function refreshNextButton(){
    const sumEl = document.getElementById('accumSummary');
    const totalEl = document.getElementById('accumTotal');
    if (roundsPlayed < 3){
      nextLevelBtn.disabled = false;
      nextLevelBtn.textContent = '‡∏î‡πà‡∏≤‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ';
      nextLevelBtn.style.opacity = '1';
      if(sumEl) sumEl.style.display = 'none';
      return;
    }
    if (roundsPlayed === 3){
      nextLevelBtn.disabled = false;
      nextLevelBtn.textContent = '‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏∞‡∏™‡∏°';
      nextLevelBtn.style.opacity = '1';
      if(sumEl) sumEl.style.display = 'none';
      return;
    }
    nextLevelBtn.disabled = true;
    nextLevelBtn.textContent = '‡∏Ñ‡∏£‡∏ö 4 ‡∏£‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß';
    nextLevelBtn.style.opacity = '0.6';
    if (sumEl && totalEl){
      totalEl.textContent = cumulativeScore.toString();
      sumEl.style.display = 'block';
    }
  }

  let running = false;
  let spawner = null;
  let countdown = null;
  let ended = false;

  const stageSeconds = 120;
  const LANES = [0.20, 0.50, 0.80];  // ‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡πÄ‡∏ß‡∏ó‡∏µ
  const WORD_SIZE = 140;             // px ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡∏µ‡πÑ‡∏ã‡∏ô‡πå (‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡πÄ‡∏Å‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏Å‡πâ‡∏≠‡∏ô)

  const MIN_GAP = 160;
  const SAFE_NEAR_TOP = 280;
  const MAX_NEAR_TOP_LANES = 2;
  const SPAWN_INTERVAL = 700;

  let gauge = 0;
  const GAIN_CORRECT = 10;
  const LOSS_WRONG   = 15;

  let kidLane = 1;
  function laneX(i){ return Math.round(DESIGN_W * LANES[i]); }     // ‡πÉ‡∏ä‡πâ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏Ç‡∏≠‡∏á‡πÄ‡∏ß‡∏ó‡∏µ
  function placeKid(){
    const x = laneX(kidLane);
    kid.style.left = x + 'px';
    kid.style.transform = 'translateX(-50%)';
  }

  function fmt(sec){
    const m = Math.floor(sec/60).toString().padStart(2,'0');
    const s = (sec%60).toString().padStart(2,'0');
    return `${m}:${s}`;
  }

  function setGauge(v){
    gauge = Math.max(0, Math.min(100, v));
    scoreFill.style.width = gauge + '%';
    scoreText.textContent = gauge;
    if(gauge >= 66) scoreFill.style.backgroundColor = '#10b981';
    else if(gauge >= 33) scoreFill.style.backgroundColor = '#f59e0b';
    else scoreFill.style.backgroundColor = '#f97316';
    if(Math.random() < 0.25){
      scoreFruit.textContent = fruits[Math.floor(Math.random()*fruits.length)];
    }
    if (running && !ended && gauge >= 100){
      endGame('win');
    }
  }

  function floatText(text, x, y, kind){
    const t = document.createElement('div');
    t.className = 'float';
    t.textContent = text;
    t.style.left = x+'px';
    t.style.top = y+'px';
    t.style.color = (kind==='ok') ? 'var(--ok)' : 'var(--bad)';
    t.style.animation = 'rise 800ms ease-out forwards';
    document.body.appendChild(t);
    t.addEventListener('animationend', () => t.remove(), {once:true});
  }

  function playHit(){
    try {
      const a = hitSound.cloneNode(true);
      a.volume = 1;
      a.src = hitSound.src;
      a.play().catch(()=>{});
    } catch(e){}
  }

  function canSpawnInLane(lane){
    const words = [...stage.querySelectorAll('.word')].filter(w => Number(w.dataset.lane) === lane);
    for(const w of words){
      const y = parseFloat(w.dataset.y)||-160;
      if(y < MIN_GAP) return false;
    }
    return true;
  }

  function hasRoomForAnotherLane(){
    const lanesUsed = new Set();
    stage.querySelectorAll('.word').forEach(w=>{
      const y = parseFloat(w.dataset.y)||-160;
      if(y < SAFE_NEAR_TOP) lanesUsed.add(Number(w.dataset.lane));
    });
    return lanesUsed.size < MAX_NEAR_TOP_LANES;
  }

  /* ====== ‡∏™‡∏≥‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥ (‡∏™‡∏∏‡πà‡∏°‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥) ====== */
  let wordPool = [];
  let poolIndex = 0;

  function refillPool(){
    const L = LEVELS[selectedLevel];
    wordPool = [];
    L.correctWords.forEach(w => wordPool.push({text:w, value:1}));
    L.wrongWords.forEach(w => wordPool.push({text:w, value:0}));
    for(let i = wordPool.length - 1; i > 0; i--){
      const j = Math.floor(Math.random() * (i + 1));
      [wordPool[i], wordPool[j]] = [wordPool[j], wordPool[i]];
    }
    poolIndex = 0;
  }

  function makeWord(){
    if(poolIndex >= wordPool.length){ refillPool(); }
    const data = wordPool[poolIndex++];

    const node = document.createElement('div');
    node.className = 'word';

    const inner = document.createElement('div');
    inner.className = 'inner';
    const fruit = document.createElement('div');
    fruit.className = 'fruit';
    fruit.textContent = fruits[Math.floor(Math.random()*fruits.length)];
    const label = document.createElement('div');
    label.className = 'label';
    label.textContent = data.text;

    node.dataset.value = data.value.toString();

    inner.appendChild(fruit);
    inner.appendChild(label);
    node.appendChild(inner);
    return node;
  }

  function spawnWord(){
    if(!running) return;
    if(!hasRoomForAnotherLane()) return;

    const order = [0,1,2].sort(()=>Math.random()-0.5);
    let chosen = null;
    for(const lane of order){
      if(canSpawnInLane(lane)){ chosen = lane; break; }
    }
    if(chosen === null) return;

    const node = makeWord();
    node.dataset.lane = chosen;
    node.dataset.y = -160;

    const x = laneX(chosen) - WORD_SIZE/2;
    node.style.left = x + 'px';
    node.style.top = (-160) + 'px';
    stage.appendChild(node);                 // ‚¨ÖÔ∏è ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ö‡∏ô‡πÄ‡∏ß‡∏ó‡∏µ (‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡πÄ‡∏Å‡∏•‡∏ï‡∏≤‡∏°)
  }

  let remain = stageSeconds;
  function currentSpeed(){ return (remain <= 40) ? 200 : 135; }

  let lastTime = 0;
  function tick(now){
    const dt = Math.min(0.05, (now - lastTime)/1000);
    lastTime = now;
    const speed = currentSpeed();

    const acceptBox = document.getElementById('acceptBox');
    const hb = acceptBox.getBoundingClientRect();   // ‚úÖ ‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏ô‡∏≤‡∏î‡∏´‡∏•‡∏±‡∏á‡∏™‡πÄ‡∏Å‡∏•‡∏à‡∏£‡∏¥‡∏á
    const hitW = Math.max(1, hb.width  * 0.60);
    const hitH = Math.max(1, hb.height * 0.30);
    const hitCx = hb.left + hb.width / 2;
    const hitCy = hb.bottom - hitH / 2 + 16;

    const hitLeft   = hitCx - hitW/2;
    const hitRight  = hitCx + hitW/2;
    const hitTop    = hitCy - hitH/2;
    const hitBottom = hitCy + hitH/2;

    stage.querySelectorAll('.word').forEach(node => {
      let y = parseFloat(node.dataset.y)||-160;
      y += speed * dt;
      node.dataset.y = y;
      node.style.transform = `translateY(${y}px)`;   // ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏ö‡∏ô‡πÄ‡∏ß‡∏ó‡∏µ (‡∏î‡∏µ‡πÑ‡∏ã‡∏ô‡πå)

      const nodeLeft = parseFloat(node.style.left)||0;
      const wordCenterX = nodeLeft + WORD_SIZE/2;
      const wordCenterY = y + WORD_SIZE/2;
      const wordBottomY = y + WORD_SIZE;

      // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô screen space ‡∏î‡πâ‡∏ß‡∏¢ getBoundingClientRect ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ä‡∏ô‡∏Å‡∏±‡∏ö hitbox ‡πÅ‡∏ö‡∏ö‡∏™‡πÄ‡∏Å‡∏•‡πÅ‡∏•‡πâ‡∏ß
      const rect = node.getBoundingClientRect();
      const wcx = rect.left + rect.width/2;
      const wcy = rect.top + rect.height/2;
      const wby = rect.top + rect.height;

      const overlapY = (wby >= hitTop) && (wcy <= hitBottom);
      const overlapX = (wcx >= (hitLeft - 100)) && (wcx <= (hitRight + 100));

      if (overlapX && overlapY){
        const isCorrect = node.dataset.value === '1';
        if(isCorrect){
          setGauge(gauge + GAIN_CORRECT);
          floatText('+'+GAIN_CORRECT, hitCx, hitBottom, 'ok');
        }else{
          setGauge(gauge - LOSS_WRONG);
          const text = node.querySelector('.label')?.textContent?.trim();
          if(text) clickedWrongWords.push(text);
          floatText('-'+LOSS_WRONG, hitCx, hitBottom, 'bad');
        }
        playHit();
        node.remove();
        return;
      }

      if(y > DESIGN_H + 180){            // ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡πÄ‡∏ß‡∏ó‡∏µ
        node.remove();
      }
    });

    if(running) requestAnimationFrame(tick);
  }

  let clickedWrongWords = [];

  function clearWordsAndFloats(){
    [...stage.querySelectorAll('.word'), ...document.querySelectorAll('.float')].forEach(el => el.remove());
  }

  function startGame(){
    running = true;
    ended = false;
    overlay.classList.remove('show');

    const L = LEVELS[selectedLevel];
    const titleEl = document.getElementById('startTitle');
    if (titleEl) titleEl.textContent = L.mission || `‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à: ${L.name}`;
    if (ruleLabelEl) ruleLabelEl.textContent = L.ruleText;

    lastRunScore = 0;
    updateAccum();

    const sumEl = document.getElementById('accumSummary');
    if(sumEl) sumEl.style.display = 'none';

    refillPool();

    setGauge(0);
    clickedWrongWords = [];
    if (wrongListEl) wrongListEl.innerHTML = '';
    if (wrongBoxEl)  wrongBoxEl.style.display = 'none';
    clearWordsAndFloats();
    placeKid();

    try { playBgm(); } catch(e){}

    remain = stageSeconds;
    timerEl.textContent = fmt(remain);
    if(countdown) clearInterval(countdown);
    countdown = setInterval(() => {
      if(!running) return;
      remain--;
      timerEl.textContent = fmt(remain);
      if(remain <= 0){ endGame('time'); }
    }, 1000);

    if(spawner) clearInterval(spawner);
    spawner = setInterval(spawnWord, SPAWN_INTERVAL);

    lastTime = performance.now();
    requestAnimationFrame(tick);
  }

  function endGame(reason='time'){
    if (ended) return;
    ended = true;
    running = false;
    clearInterval(countdown); countdown=null;
    clearInterval(spawner);   spawner=null;
    finalScoreEl.textContent = gauge.toString();

    lastRunScore = gauge;
    endTitleEl.textContent = (reason === 'win') ? '‡πÄ‡∏Å‡πà‡∏á‡∏°‡∏≤‡∏Å! ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏ï‡πá‡∏° üéâ' : '‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤!';

    if (wrongListEl){
      if (clickedWrongWords.length === 0){
        if (wrongBoxEl) wrongBoxEl.style.display = 'none';
      } else {
        const seen = new Set();
        const unique = clickedWrongWords.filter(w => (seen.has(w) ? false : (seen.add(w), true)));
        wrongListEl.innerHTML = unique.map(w => `<span class="chip">${w}</span>`).join('');
        if (wrongBoxEl) wrongBoxEl.style.display = 'block';
      }
    }

    try{ if (theWin) { theWin.currentTime = 0; theWin.play().catch(()=>{}); } }catch(e){}
    try{ if(bgm){ bgm.pause(); bgm.currentTime = 0; } }catch(e){}

    refreshNextButton();
    overlay.classList.add('show');
  }

  window.addEventListener('keydown', (e) => {
    if(!running) return;
    const k = e.key.toLowerCase();
    if(k === 'arrowleft' || k === 'a'){ kidLane = Math.max(0, kidLane-1); placeKid(); }
    else if(k === 'arrowright' || k === 'd'){ kidLane = Math.min(2, kidLane+1); placeKid(); }
  });

  // ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÅ‡∏ö‡πà‡∏á 3 ‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏ß‡∏ó‡∏µ (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏à‡∏≠) ‚Äî ‡πÉ‡∏ä‡πâ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÄ‡∏°‡∏≤‡∏™‡πå‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÄ‡∏ß‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á‡∏™‡πÄ‡∏Å‡∏•
  stage.addEventListener('click', (e) => {
    if(!running) return;
    const rect = stage.getBoundingClientRect();
    const x = e.clientX - rect.left;       // screen ‚Üí stage space
    const nx = x / rect.width;
    if(nx < 1/3) kidLane = 0; else if(nx < 2/3) kidLane = 1; else kidLane = 2;
    placeKid();
  });

  // resize ‡πÄ‡∏â‡∏¢ ‡πÜ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° ‡∏ô‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ß‡∏≤‡∏á kid ‡πÉ‡∏´‡∏°‡πà (‡∏ï‡∏≤‡∏°‡πÄ‡∏•‡∏ô‡πÄ‡∏ß‡∏ó‡∏µ)
  window.addEventListener('resize', placeKid);

  restartBtn.addEventListener('click', () => { startGame(); });

  selectLevelBtn.addEventListener('click', () => {
    overlay.classList.remove('show');
    clearWordsAndFloats();
    cumulativeScore = 0; roundsPlayed = 0; lastRunScore = 0; updateAccum();
    const landing = document.getElementById('landing');
    const startScreen = document.getElementById('startScreen');
    if (landing){ landing.classList.remove('hide'); }
    if (startScreen){ startScreen.style.display = 'none'; }
  });

  nextLevelBtn.addEventListener('click', () => {
    if (roundsPlayed < 3) {
      cumulativeScore += lastRunScore; roundsPlayed++; updateAccum();
      selectedLevel = (selectedLevel + 1) % LEVELS.length;
      overlay.classList.remove('show');
      openStartForLevel(true);
      return;
    }
    if (roundsPlayed === 3) {
      cumulativeScore += lastRunScore; roundsPlayed++; updateAccum();
      const sumEl = document.getElementById('accumSummary');
      const totalEl = document.getElementById('accumTotal');
      if (sumEl && totalEl){ totalEl.textContent = cumulativeScore.toString(); sumEl.style.display = 'block'; }
      endTitleEl.textContent = '‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏∞‡∏™‡∏°';
      finalScoreEl.textContent = lastRunScore.toString();
      refreshNextButton();
      return;
    }
  });

  /* API ‡πÉ‡∏´‡πâ‡∏´‡∏ô‡πâ‡∏≤ Landing */
  window.__GAME__ = {
    startGame,
    setSelectedLevel: (i)=>{ selectedLevel = i|0; },
    getLevel: (i)=> LEVELS[i],
    getMissionFor: (i)=> (LEVELS[i] && LEVELS[i].mission) ? LEVELS[i].mission : '',
    moveLane: (lane)=>{ if([0,1,2].includes(lane)){ kidLane = lane; placeKid(); } },
    __isRunning: () => running,
    getLane: () => kidLane
  };

  /* Pause / Resume ‚Äî ‡∏Å‡∏±‡∏ô interval ‡∏ã‡πâ‡∏≠‡∏ô */
  const pauseBtn = document.getElementById('pauseBtn');
  let paused = false;

  function pauseGame(){
    if (!running || ended) return;
    paused = true; running = false;
    if (countdown) { clearInterval(countdown); countdown = null; }
    if (spawner)   { clearInterval(spawner);   spawner   = null; }
  }
  function resumeGame(){
    if (!paused || ended) return;
    paused = false; running = true;
    lastTime = performance.now();
    if (countdown) { clearInterval(countdown); countdown = null; }
    if (spawner)   { clearInterval(spawner);   spawner   = null; }
    countdown = setInterval(() => {
      if(!running) return;
      remain--;
      timerEl.textContent = fmt(remain);
      if(remain <= 0){ endGame('time'); }
    }, 1000);
    spawner = setInterval(spawnWord, SPAWN_INTERVAL);
    requestAnimationFrame(tick);
  }
  if(pauseBtn){
    pauseBtn.addEventListener('click', ()=>{
      if (!paused) { pauseGame();  pauseBtn.textContent = '‚ñ∂Ô∏è ‡∏ï‡πà‡∏≠'; }
      else         { resumeGame(); pauseBtn.textContent = '‚è∏ ‡∏´‡∏¢‡∏∏‡∏î'; }
    });
  }
  const quickHome = document.getElementById('quickRestart');
  if(quickHome){ quickHome.addEventListener('click', ()=>{ location.reload(); }); }

})();
</script>

<!-- ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°: ‡∏ô‡∏±‡∏ö‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á -->
<script>
(function(){
  const startScreen = document.getElementById('startScreen');
  const startBtn = document.getElementById('startBtn');
  const countdownEl = document.getElementById('countdown');
  const restartBtn = document.getElementById('restartBtn');

  if(!startScreen || !startBtn || !countdownEl || !restartBtn) return;

  let isCounting = false;

  function startCountdown(){
    if (isCounting) return;
    isCounting = true;

    let n = 3;
    countdownEl.textContent = n;
    countdownEl.style.display = 'block';

    const itv = setInterval(() => {
      n--;
      if(n > 0){
        countdownEl.textContent = n;
      } else {
        clearInterval(itv);
        startScreen.style.display = 'none';
        isCounting = false;
        if(window.__GAME__) window.__GAME__.startGame();
      }
    }, 1000);
  }

  startBtn.addEventListener('click', () => {
    if (startBtn.disabled) return;
    startBtn.disabled = true;
    startBtn.style.display = 'none';
    startCountdown();
  });

  restartBtn.addEventListener('click', () => {
    if(window.__GAME__) window.__GAME__.startGame();
  });
})();
</script>

<!-- Landing bindings -->
<script>
(function(){
  const landing     = document.getElementById('landing');
  const levelBtns   = document.querySelectorAll('.levelBtn');
  const startScreen = document.getElementById('startScreen');
  const startTitle  = document.getElementById('startTitle');

  levelBtns.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const idx = parseInt(btn.getAttribute('data-level'),10);
      if (Number.isNaN(idx)) return;

      if(window.__GAME__ && window.__GAME__.setSelectedLevel){
        window.__GAME__.setSelectedLevel(idx);
      }
      const L = (window.__GAME__ && window.__GAME__.getLevel) ? window.__GAME__.getLevel(idx) : null;
      startTitle.textContent = (L && L.mission) ? L.mission : `‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à: ${btn.textContent}`;

      landing.classList.add('hide');
      startScreen.style.display = 'flex';
      const startBtn = document.getElementById('startBtn');
      if (startBtn) {
        startBtn.disabled = false;
        startBtn.style.display = 'inline-block';
      }
      const countdownEl = document.getElementById('countdown');
      if (countdownEl){ countdownEl.style.display = 'none'; }
    });
  });

  const guideBtn  = document.getElementById('guideBtn');
  const guide     = document.getElementById('guideScreen');
  const guideBack = document.getElementById('guideBack');

  if (guideBtn && guide){
    guideBtn.addEventListener('click', ()=>{
      landing.classList.add('hide');
      guide.style.display = 'flex';
    });
  }
  if (guideBack && guide){
    guideBack.addEventListener('click', ()=>{
      guide.style.display = 'none';
      landing.classList.remove('hide');
    });
  }
})();
</script>

</body>
</html>
